var d=class{constructor(e,i="",t=[]){this.router=e,this.prefix=i,this.middleware=t;}addMiddleware(e){this.middleware.push(e);}appendPrefix(e){this.prefix+=`/${e.trim().replace(/^\/|\/$/g,"")}`;}group(e,i){let t=new d(this.router,this.prefix,[...this.middleware]);if(e?.prefix?.length&&t.appendPrefix(e.prefix),e?.middleware)if(Array.isArray(e.middleware))for(let r=0;r<e.middleware.length;r++)t.addMiddleware(e.middleware[r]);else t.addMiddleware(e.middleware);i(t);}add(e,i){let t=`${this.prefix}/${e.trim().replace(/^\/|\/$/g,"")}`;this.router.add(t,i,[...this.middleware]);}redirect(e,i,t=null){let r=`${this.prefix}/${e.trim().replace(/^\/|\/$/g,"")}`;this.router.redirect(r,i,[...this.middleware]);}};var h=class{constructor(){this.hijackPopstate=e=>{"url"in e.state&&this.route(e.state.url,"replace");};this.hijackClick=e=>{let t=e.target.closest("[href]");if(t instanceof HTMLAnchorElement&&t.target!=="_blank"&&t.getAttribute("href")!==null&&(t.href.indexOf(location.origin)===0||t.href.indexOf("/")===0||t.href.indexOf("#")===0||t.href===""||t.href.indexOf("http")===-1)){e.preventDefault(),e.stopPropagation();let r=t.getAttribute("href"),a=t.getAttribute("history");a==="push"||a==="replace"?this.route(r,a):this.route(r);}};this.routes=[],this.mountingPoint=null,this.modules={},this.lastRoute=null,this.autoTransitionTimer=5e3,this.useTransitions=!1,this.transitionPromises={resolve:()=>{},timeoutId:null},window.addEventListener("click",this.hijackClick,{capture:!0}),window.addEventListener("popstate",this.hijackPopstate,{capture:!0});}enableTransitions(){this.useTransitions=!0;}disableTransitions(){this.useTransitions=!1;}setTransitionTimer(e){if(e<-1)throw "Timer value out of bounds. Value must be greater than or equal to -1.";this.autoTransitionTimer=e;}transition(){this.transitionPromises.timeoutId!==null&&clearTimeout(this.transitionPromises.timeoutId),this.transitionPromises.resolve();}group(e,i){let t=new d(this);if(e?.prefix?.length&&t.appendPrefix(e.prefix),e?.middleware)if(Array.isArray(e.middleware))for(let r=0;r<e.middleware.length;r++)t.addMiddleware(e.middleware[r]);else t.addMiddleware(e.middleware);i(t);}add(e,i,t=null){let r=this.prepareRouteModel(e);typeof i=="string"?(r.tagName=i,i.indexOf("http")===0?r.file=i:r.file=`./${i.trim().replace(/(\.js)$/,"").trim()}.js`):i instanceof Function?r.closure=i:(r.tagName=i.tagName,r.file=i.file),t instanceof Function?r.middleware.push(t):Array.isArray(t)&&(r.middleware=[...r.middleware,...t]),this.routes.push(r);}redirect(e,i,t=null){let r=this.prepareRouteModel(e);t instanceof Function?r.middleware.push(t):Array.isArray(t)&&(r.middleware=[...r.middleware,...t]),r.redirect=i.trim().replace(/^\/|\/$/g,""),this.routes.push(r);}prepareRouteModel(e){let i={tokens:[],regex:[],middleware:[],route:e.trim().replace(/^\/|$\//g,""),segments:[]},t=i.route.match(/\{.*?\}/g)??[];for(let r=0;r<t.length;r++)if(t[r].indexOf(":")!==-1){let a=t[r].replace(/\{|\}/g,"").trim().replace(/\:.*/,"").trim();i.tokens.push(a);let n=t[r].replace(/^\{|\}$/g,"").trim().replace(/.*?\:/,"").trim();i.regex.push(new RegExp(n)),i.route=i.route.replace(t[r],`:${r}`);}else i.tokens.push(t[r].replace(/\{|\}/g,"").trim()),i.regex.push(new RegExp(/.*/)),i.route=i.route.replace(t[r],`:${r}`);return i.route=i.route.trim().replace(/\/+/g,"/").toLowerCase(),i.segments=i.route.split("/"),i}mount(e){this.mountingPoint=e,this.route(location.href,"replace"),this.dispatchEvent("ready");}navigateTo(e,i="push"){e.indexOf(location.origin)===0||e.indexOf("/")===0||e.indexOf("#")===0||e===""||e.indexOf("http")===-1?this.route(e,i):console.error(`Invalid URL: ${e}`);}pageJump(e,i="smooth"){let t=document.body.querySelector(`#${e.replace(/^\#/,"")}`);t&&t.scrollIntoView({behavior:i,block:"center",inline:"center"}),this.replaceState(`${location.origin}${location.pathname}${e}`);}replaceState(e){e=e.replace(location.origin,"").replace(/^\//,"").trim(),window.history.replaceState({url:e},document.title,`${location.origin}/${e}`);}pushState(e){e=e.replace(location.origin,"").replace(/^\//,"").trim(),window.history.pushState({url:e},document.title,`${location.origin}/${e}`);}mountElement(e,i,t){this.mountingPoint?.firstElementChild?.remove(),this.mountingPoint.appendChild(e),t==="replace"?this.replaceState(`${location.origin}/${i}`):this.pushState(`${location.origin}/${i}`);}async importModule(e){let i=null;try{i=await import(e);}catch(t){console.error(t);}return i}parseTokens(e,i){let t={};if(i===null||i.segments[0]==="*")return t;e=e.replace(/\?.*|\#.*/,"").trim().replace(/\/+/g,"/");let r=e.split("/");for(let a=0;a<r.length;a++)if(i.segments?.[a]?.indexOf(":")!==-1){let n=parseInt(i.segments[a].substring(1));t[i.tokens[n]]=r[a];}return t}parseGetParams(e){let i={},t=e?.match(/\?.*(?=\#|$)/)?.[0]??null;if(!t)return i;let r=new URLSearchParams(t);return r.forEach((a,n)=>{if(!i?.[n]){let o=r.getAll(n);o.length>1?i[n]=o:i[n]=o[0];}}),i}async import(e,i,t,r,a){try{if(this.modules?.[e.tagName])return new this.modules[e.tagName].default(t,r,a);let n=await this.importModule(e.file);if(n===null)return console.error(`Failed to import module: ${e.file}`),null;if(!n?.default){let o=Object.keys(n)?.[0]??null;if(!o)return console.error(`Failed to find module export: ${e.file}`),null;n=Object.assign({default:n[o]},n);}return this.modules[e.tagName]=n,customElements.get(e.tagName)||customElements.define(e.tagName,n.default),new this.modules[e.tagName].default(t,r,a)}catch(n){return console.error(n),null}}findRouteModel(e){let i=null,r=e.replace(/\?.*|\#.*/g,"").trim().replace(/^\/|\/$/g,"").trim().replace(/\/+/g,"/").toLowerCase().split("/");for(let a=0;a<this.routes.length;a++){let n=this.routes[a];if(n.segments.includes("*")||n.segments.length===r.length){let o=!1;for(let s=0;s<n.segments.length;s++)if(n.segments[s]!==r[s])if(n.segments[s].indexOf(":")!==-1){let c=parseInt(n.segments[s].substring(1));if(n.regex[c].test(r[s]))continue;o=!0;break}else {if(n.segments[s]==="*")break;o=!0;break}if(!o){i=n;break}}}return i}async route(e,i="push"){e=e.replace(location.origin,"").replace(/^\/|\/$/g,"").trim();let t={},r=this.parseGetParams(e),a={},n="",o=`/${e.replace(/(\?|\#).*/,"").trim()}`;if(e.indexOf("#")!==-1&&(n=e.match(/\#.*/)[0]),e.indexOf("#")===0)this.pageJump(e);else {document.documentElement.setAttribute("router","loading"),this.dispatchEvent("preloading",{path:o,hash:n,params:r});try{let s=this.findRouteModel(e);a=this.parseTokens(e,s);let c=null;if(this.useTransitions&&this.lastRoute!==null&&(c=new Promise(u=>{let p=null;this.autoTransitionTimer!==null&&this.autoTransitionTimer!==1/0&&this.autoTransitionTimer!==-1&&(p=setTimeout(u,this.autoTransitionTimer)),this.transitionPromises={resolve:u,timeoutId:p};})),this.dispatchEvent("loading",{path:o.length?o:"/",hash:n,params:r,tokens:a,data:t}),s===null)throw "/404";if(s.middleware.length)for(let u of s.middleware)await u({...a},{...r},t);if(s?.redirect!=null){let u=this.parseGetParams(s.redirect),p=s.redirect.match(/\#.*/)?.[0]??"",m=`/${s.redirect.replace(/(\?|\#).*/,"").trim()}`;this.dispatchEvent("redirecting",{path:m,params:u,hash:p}),this.navigateTo(s.redirect,i);return}if(s?.closure)await s.closure({...a},{...r},t);else {let u=await this.import(s,e,{...a},{...r},{...t});if(u===null)return;c!=null&&await c,this.mountElement(u,e,i),n.length?this.pageJump(n,"auto"):window.scrollTo({top:0,left:0,behavior:"auto"});}document.documentElement.setAttribute("router","idling"),this.dispatchEvent("loaded",{path:o.length?o:"/",hash:n,tokens:a,params:r,data:t}),this.lastRoute={path:o.length?o:"/",hash:n,tokens:a,params:r};}catch(s){let c=this.parseGetParams(s),u=s.match(/\#.*/)?.[0]??"",p=`/${s.replace(/(\?|\#).*/,"").trim()}`;this.dispatchEvent("redirecting",{path:p,hash:u,params:c}),this.navigateTo(s);}}}dispatchEvent(e,i=null){let t;switch(e){case"ready":t=new CustomEvent(`router:${e}`);break;default:t=new CustomEvent(`router:${e}`,{detail:{outgoing:this.lastRoute,incoming:i}});break}document.dispatchEvent(t);}},l=new h,w=l.navigateTo.bind(l),b=l.mount.bind(l),T=l.pageJump.bind(l),P=l.replaceState.bind(l),x=l.pushState.bind(l),$=l.transition.bind(l);

export { b as mount, w as navigateTo, T as pageJump, x as pushState, P as replaceState, l as router, $ as transition };
