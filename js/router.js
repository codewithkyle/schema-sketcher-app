var m=class{constructor(e,t="",i=[]){this.router=e,this.prefix=t,this.middleware=i}addMiddleware(e){this.middleware.push(e)}appendPrefix(e){this.prefix+=`/${e.trim().replace(/^\/|\/$/g,"")}`}group(e,t){let i=new m(this.router,this.prefix,[...this.middleware]);if(e?.prefix?.length&&i.appendPrefix(e.prefix),e?.middleware)if(Array.isArray(e.middleware))for(let r=0;r<e.middleware.length;r++)i.addMiddleware(e.middleware[r]);else i.addMiddleware(e.middleware);t(i)}add(e,t){let i=`${this.prefix}/${e.trim().replace(/^\/|\/$/g,"")}`;this.router.add(i,t,[...this.middleware])}redirect(e,t,i=null){let r=`${this.prefix}/${e.trim().replace(/^\/|\/$/g,"")}`;this.router.redirect(r,t,[...this.middleware])}},c=class{constructor(){this.hijackPopstate=e=>{"url"in e.state&&this.route(e.state.url,"replace")},this.hijackClick=e=>{let t=e.target.closest("[href]");if(t instanceof HTMLAnchorElement&&t.target!=="_blank"&&t.getAttribute("href")!==null&&(t.href.indexOf(location.origin)===0||t.href.indexOf("/")===0||t.href.indexOf("#")===0||t.href===""||t.href.indexOf("http")===-1)){e.preventDefault(),e.stopPropagation();let i=t.getAttribute("href"),r=t.getAttribute("history");r==="push"||r==="replace"?this.route(i,r):this.route(i)}},this.routes=[],this.mountingPoint=null,this.modules={},this.lastRoute=null,this.autoTransitionTimer=5e3,this.useTransitions=!1,this.transitionPromises={resolve:()=>{},timeoutId:null},window.addEventListener("click",this.hijackClick,{capture:!0}),window.addEventListener("popstate",this.hijackPopstate,{capture:!0})}enableTransitions(){this.useTransitions=!0}disableTransitions(){this.useTransitions=!1}setTransitionTimer(e){if(e<-1)throw"Timer value out of bounds. Value must be greater than or equal to -1.";this.autoTransitionTimer=e}transition(){this.transitionPromises.timeoutId!==null&&clearTimeout(this.transitionPromises.timeoutId),this.transitionPromises.resolve()}group(e,t){let i=new m(this);if(e?.prefix?.length&&i.appendPrefix(e.prefix),e?.middleware)if(Array.isArray(e.middleware))for(let r=0;r<e.middleware.length;r++)i.addMiddleware(e.middleware[r]);else i.addMiddleware(e.middleware);t(i)}add(e,t,i=null){let r=this.prepareRouteModel(e);typeof t=="string"?(r.tagName=t,t.indexOf("http")===0?r.file=t:r.file=`./${t.trim().replace(/(\.js)$/,"").trim()}.js`):t instanceof Function?r.closure=t:(r.tagName=t.tagName,r.file=t.file),i instanceof Function?r.middleware.push(i):Array.isArray(i)&&(r.middleware=[...r.middleware,...i]),this.routes.push(r)}redirect(e,t,i=null){let r=this.prepareRouteModel(e);i instanceof Function?r.middleware.push(i):Array.isArray(i)&&(r.middleware=[...r.middleware,...i]),r.redirect=t.trim().replace(/^\/|\/$/g,""),this.routes.push(r)}prepareRouteModel(e){let t={tokens:[],regex:[],middleware:[],route:e.trim().replace(/^\/|$\//g,""),segments:[]},i=t.route.match(/\{.*?\}/g)??[];for(let r=0;r<i.length;r++)if(i[r].indexOf(":")!==-1){let s=i[r].replace(/\{|\}/g,"").trim().replace(/\:.*/,"").trim();t.tokens.push(s);let a=i[r].replace(/^\{|\}$/g,"").trim().replace(/.*?\:/,"").trim();t.regex.push(new RegExp(a)),t.route=t.route.replace(i[r],`:${r}`)}else t.tokens.push(i[r].replace(/\{|\}/g,"").trim()),t.regex.push(new RegExp(/.*/)),t.route=t.route.replace(i[r],`:${r}`);return t.route=t.route.trim().replace(/\/+/g,"/").toLowerCase(),t.segments=t.route.split("/"),t}mount(e){this.mountingPoint=e,this.route(location.href,"replace"),this.dispatchEvent("ready")}navigateTo(e,t="push"){e.indexOf(location.origin)===0||e.indexOf("/")===0||e.indexOf("#")===0||e===""||e.indexOf("http")===-1?this.route(e,t):console.error(`Invalid URL: ${e}`)}pageJump(e,t="smooth"){let i=document.body.querySelector(`#${e.replace(/^\#/,"")}`);i&&i.scrollIntoView({behavior:t,block:"center",inline:"center"}),this.replaceState(`${location.origin}${location.pathname}${e}`)}replaceState(e){e=e.replace(location.origin,"").replace(/^\//,"").trim(),window.history.replaceState({url:e},document.title,`${location.origin}/${e}`)}pushState(e){e=e.replace(location.origin,"").replace(/^\//,"").trim(),window.history.pushState({url:e},document.title,`${location.origin}/${e}`)}mountElement(e,t,i){this.mountingPoint?.firstElementChild?.remove(),this.mountingPoint.appendChild(e),i==="replace"?this.replaceState(`${location.origin}/${t}`):this.pushState(`${location.origin}/${t}`)}async importModule(e){let t=null;try{t=await import(e)}catch(i){console.error(i)}return t}parseTokens(e,t){let i={};if(t===null||t.segments[0]==="*")return i;e=e.replace(/\?.*|\#.*/,"").trim().replace(/\/+/g,"/");let r=e.split("/");for(let s=0;s<r.length;s++)if(t.segments?.[s]?.indexOf(":")!==-1){let a=parseInt(t.segments[s].substring(1));i[t.tokens[a]]=r[s]}return i}parseGetParams(e){let t={},i=e?.match(/\?.*(?=\#|$)/)?.[0]??null;if(!i)return t;let r=new URLSearchParams(i);return r.forEach((s,a)=>{if(!t?.[a]){let n=r.getAll(a);n.length>1?t[a]=n:t[a]=n[0]}}),t}async import(e,t,i,r,s){try{if(this.modules?.[e.tagName])return new this.modules[e.tagName].default(i,r,s);let a=await this.importModule(e.file);if(a===null)return console.error(`Failed to import module: ${e.file}`),null;if(!a?.default){let n=Object.keys(a)?.[0]??null;if(!n)return console.error(`Failed to find module export: ${e.file}`),null;a=Object.assign({default:a[n]},a)}return this.modules[e.tagName]=a,customElements.get(e.tagName)||customElements.define(e.tagName,a.default),new this.modules[e.tagName].default(i,r,s)}catch(a){return console.error(a),null}}findRouteModel(e){let t=null,i=e.replace(/\?.*|\#.*/g,"").trim().replace(/^\/|\/$/g,"").trim().replace(/\/+/g,"/").toLowerCase().split("/");for(let r=0;r<this.routes.length;r++){let s=this.routes[r];if(s.segments.includes("*")||s.segments.length===i.length){let a=!1;for(let n=0;n<s.segments.length;n++)if(s.segments[n]!==i[n])if(s.segments[n].indexOf(":")!==-1){let l=parseInt(s.segments[n].substring(1));if(s.regex[l].test(i[n]))continue;a=!0;break}else{if(s.segments[n]==="*")break;a=!0;break}if(!a){t=s;break}}}return t}async route(e,t="push"){e=e.replace(location.origin,"").replace(/^\/|\/$/g,"").trim();let i={},r=this.parseGetParams(e),s={},a="",n=`/${e.replace(/(\?|\#).*/,"").trim()}`;if(e.indexOf("#")!==-1&&(a=e.match(/\#.*/)[0]),e.indexOf("#")===0)this.pageJump(e);else{document.documentElement.setAttribute("router","loading"),this.dispatchEvent("preloading",{path:n,hash:a,params:r});try{let l=this.findRouteModel(e);s=this.parseTokens(e,l);let h=null;if(this.useTransitions&&this.lastRoute!==null&&(h=new Promise(u=>{let d=null;this.autoTransitionTimer!==null&&this.autoTransitionTimer!==1/0&&this.autoTransitionTimer!==-1&&(d=setTimeout(u,this.autoTransitionTimer)),this.transitionPromises={resolve:u,timeoutId:d}})),this.dispatchEvent("loading",{path:n.length?n:"/",hash:a,params:r,tokens:s,data:i}),l===null)throw"/404";if(l.middleware.length)for(let u of l.middleware)await u({...s},{...r},i);if(l?.redirect!=null){let u=this.parseGetParams(l.redirect),d=l.redirect.match(/\#.*/)?.[0]??"",p=`/${l.redirect.replace(/(\?|\#).*/,"").trim()}`;this.dispatchEvent("redirecting",{path:p,params:u,hash:d}),this.navigateTo(l.redirect,t);return}if(l?.closure)await l.closure({...s},{...r},i);else{let u=await this.import(l,e,{...s},{...r},{...i});if(u===null)return;h!=null&&await h,this.mountElement(u,e,t),a.length?this.pageJump(a,"auto"):window.scrollTo({top:0,left:0,behavior:"auto"})}document.documentElement.setAttribute("router","idling"),this.dispatchEvent("loaded",{path:n.length?n:"/",hash:a,tokens:s,params:r,data:i}),this.lastRoute={path:n.length?n:"/",hash:a,tokens:s,params:r}}catch(l){let h=this.parseGetParams(l),u=l.match(/\#.*/)?.[0]??"",d=`/${l.replace(/(\?|\#).*/,"").trim()}`;this.dispatchEvent("redirecting",{path:d,hash:u,params:h}),this.navigateTo(l)}}}dispatchEvent(e,t=null){let i;switch(e){case"ready":i=new CustomEvent(`router:${e}`);break;default:i=new CustomEvent(`router:${e}`,{detail:{outgoing:this.lastRoute,incoming:t}});break}document.dispatchEvent(i)}},o=new c,g=o.navigateTo.bind(o),f=o.mount.bind(o),w=o.pageJump.bind(o),$=o.replaceState.bind(o),x=o.pushState.bind(o),T=o.transition.bind(o);export{f as mount,g as navigateTo,w as pageJump,x as pushState,$ as replaceState,o as router,T as transition};
