import{html as s,render as u}from"./lit-html.js";import d from"./connector-component.js";import l from"./diagram-controller.js";import c from"./env.js";import{publish as n}from"./pubsub.js";import h from"./component.js";import{parseDataset as p}from"./general.js";class m extends h{constructor(){super();this.handleMouseEnter=e=>{n("canvas",{type:"highlight",ref:this.model.uid})};this.handleMouseLeave=e=>{n("canvas",{type:"clear-highlight",ref:this.model.uid})};this.debounceName=this.debounce(this.updateName.bind(this),300);this.handleNameInput=e=>{const t=e.currentTarget;this.debounceName(t.value)};this.handleKeyboard=e=>{if(e instanceof KeyboardEvent&&e.metaKey||e.ctrlKey){const t=this.closest("table-component");switch(e.key){case"Enter":e.preventDefault(),l.createColumn(this.model.tableID),t.render(),t.focusLastColumn();break;case"Delete":e.preventDefault(),l.deleteColumn(this.model.uid),this.remove(),t.focusLastColumn();break;case"p":e.preventDefault();const i=!this.model.isPrimaryKey;l.changeColumnPrimaryKey(this.model.uid,i),this.set({isPrimaryKey:i});break;case"u":e.preventDefault();const a=!this.model.isUnique;l.changeColumnUnique(this.model.uid,a),this.set({isUnique:a});break;case"i":e.preventDefault();const r=!this.model.isIndex;l.changeColumnIndex(this.model.uid,r),this.set({isIndex:r});break;case"k":e.preventDefault();const o=!this.model.isNullable;l.changeColumnNullable(this.model.uid,o),this.set({isNullable:o});break;default:break}}};this.changeType=e=>{const i=e.currentTarget.value;l.changeColumnType(this.model.uid,i),this.set({type:i})};this.endDraw=e=>{n("canvas",{type:"end",id:this.model.uid,tableID:this.model.tableID,refs:[this.model.tableID,this.model.uid]})};this.model={name:"",type:"",isNullable:!1,isUnique:!1,isIndex:!1,isPrimaryKey:!1,weight:0,uid:"",tableID:""}}static get observedAttributes(){return["data-uid"]}async connected(){this.addEventListener("mouseenter",this.handleMouseEnter),this.addEventListener("mouseleave",this.handleMouseLeave),this.addEventListener("keydown",this.handleKeyboard,{passive:!1,capture:!0}),await c.css(["column-component"]);const e=p(this.dataset,this.model),t=l.getColumn(e.uid);this.set(t)}updateName(e){this.set({name:e}),l.renameColumn(this.model.uid,e)}renderPrimaryKey(){let e;return this.model.isPrimaryKey?e=s`
                <i tooltip aria-label="Primary key">
                    <svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M336 32c79.529 0 144 64.471 144 144s-64.471 144-144 144c-18.968 0-37.076-3.675-53.661-10.339L240 352h-48v64h-64v64H32v-80l170.339-170.339C195.675 213.076 192 194.968 192 176c0-79.529 64.471-144 144-144m0-32c-97.184 0-176 78.769-176 176 0 15.307 1.945 30.352 5.798 44.947L7.029 379.716A24.003 24.003 0 0 0 0 396.686V488c0 13.255 10.745 24 24 24h112c13.255 0 24-10.745 24-24v-40h40c13.255 0 24-10.745 24-24v-40h19.314c6.365 0 12.47-2.529 16.971-7.029l30.769-30.769C305.648 350.055 320.693 352 336 352c97.184 0 176-78.769 176-176C512 78.816 433.231 0 336 0zm48 108c11.028 0 20 8.972 20 20s-8.972 20-20 20-20-8.972-20-20 8.972-20 20-20m0-28c-26.51 0-48 21.49-48 48s21.49 48 48 48 48-21.49 48-48-21.49-48-48-48z"></path></svg>
                </i>
            `:e="",e}renderUnique(){let e;return this.model.isUnique?e=s`
                <i tooltip aria-label="Unique" >
                    <svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M388.1 333.5l52.7-14.3c4.2-1.1 6.7-5.5 5.6-9.8l-4.1-15.5c-1.1-4.3-5.5-6.8-9.7-5.7l-83.2 22.6-93.8-54.8 93.8-54.8 83.2 22.6c4.2 1.1 8.6-1.4 9.7-5.7l4.1-15.5c1.1-4.3-1.4-8.7-5.6-9.8l-52.7-14.3 55.9-32.7c3.8-2.2 5.1-7.1 2.9-10.9L439 121c-2.2-3.8-7-5.1-10.8-2.9l-55.9 32.7 14.1-53.3c1.1-4.3-1.4-8.7-5.6-9.8l-15.3-4.1c-4.2-1.1-8.6 1.4-9.7 5.7l-22.3 84.2-93.8 54.8V118.6l61-61.6c3.1-3.1 3.1-8.2 0-11.3l-11.2-11.3c-3.1-3.1-8.1-3.1-11.2 0l-38.6 39V8c0-4.4-3.5-8-7.9-8H216c-4.4 0-7.9 3.6-7.9 8v65.4l-38.6-39c-3.1-3.1-8.1-3.1-11.2 0l-11.2 11.3c-3.1 3.1-3.1 8.2 0 11.3l60.9 61.7v109.7l-93.8-54.8-22.1-84.4c-1.1-4.3-5.5-6.8-9.7-5.7l-15.3 4.1c-4.2 1.1-6.7 5.5-5.6 9.8l14.1 53.3L19.7 118c-3.8-2.2-8.6-.9-10.8 2.9L1 134.8c-2.2 3.8-.9 8.7 2.9 10.9l55.9 32.7-52.6 14.4c-4.2 1.1-6.7 5.5-5.6 9.8l4.1 15.5c1.1 4.3 5.5 6.8 9.7 5.7l83.2-22.6 93.8 54.8-93.8 54.8-83.2-22.6c-4.2-1.1-8.6 1.4-9.7 5.7l-4.1 15.5c-1.1 4.3 1.4 8.7 5.6 9.8l52.7 14.3L4 366.1c-3.8 2.2-5.1 7.1-2.9 10.9L9 390.9c2.2 3.8 7 5.1 10.8 2.9l55.9-32.7-14.1 53.3c-1.1 4.3 1.4 8.7 5.6 9.8l15.3 4.1c4.2 1.1 8.6-1.4 9.7-5.7l22.3-84.2 93.8-54.8v109.7l-61 61.7c-3.1 3.1-3.1 8.2 0 11.3l11.2 11.3c3.1 3.1 8.1 3.1 11.2 0l38.6-39V504c0 4.4 3.5 8 7.9 8H232c4.4 0 7.9-3.6 7.9-8v-65.4l38.6 39c3.1 3.1 8.1 3.1 11.2 0l11.2-11.3c3.1-3.1 3.1-8.2 0-11.3L240 393.3V283.7l93.8 54.8 22.3 84.2c1.1 4.3 5.5 6.8 9.7 5.7l15.3-4.1c4.2-1.1 6.7-5.5 5.6-9.8l-14.1-53.3 55.9 32.7c3.8 2.2 8.6.9 10.8-2.9l7.9-13.9c2.2-3.8.9-8.7-2.9-10.9l-56.2-32.7z"></path></svg>
                </i>
            `:e="",e}renderIndex(){let e;return this.model.isIndex?e=s`
                <i tooltip aria-label="Index">
                    <svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 288 512"><path fill="currentColor" d="M144 0C64.47 0 0 64.47 0 144c0 74.05 56.1 134.33 128 142.39v206.43l11.01 16.51c2.38 3.56 7.61 3.56 9.98 0L160 492.82V286.39c71.9-8.05 128-68.34 128-142.39C288 64.47 223.53 0 144 0zm0 256c-61.76 0-112-50.24-112-112S82.24 32 144 32s112 50.24 112 112-50.24 112-112 112zm0-192c-44.12 0-80 35.89-80 80 0 8.84 7.16 16 16 16s16-7.16 16-16c0-26.47 21.53-48 48-48 8.84 0 16-7.16 16-16s-7.16-16-16-16z"></path></svg>
                </i>
            `:e="",e}updateData(){const e=l.getColumn(this.model.uid);this.set(e)}render(){this.dataset.uid=this.model.uid;const e=s`
            ${new d("top: 50%;transform: translateY(-50%);left: -7px;",this.model.uid,"left",this.model.tableID,[this.model.tableID,this.model.uid])}
            <div @mouseup=${this.endDraw} tabindex="0" class="w-full h-full" flex="row nowrap items-center">
                <div flex="row nowrap items-center" style="flex:1;width:100%">
                    <i class="handle">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 8l16 0" /><path d="M4 16l16 0" /></svg>
                    </i>
                    ${this.renderPrimaryKey()}
                    ${this.renderIndex()}
                    ${this.renderUnique()}
                    <input type="text" .value="${this.model.name}" @input=${this.handleNameInput}>
                </div>
                <div flex="row nowrap items-center" class="h-full">
                    <select @change=${this.changeType}>
                        ${l.getTypes().map(t=>s`<option value="${t.uid}" ?selected=${this.model.type===t.uid}>${t.name}${this.model.isNullable?"?":""}</option>`)}
                    </select>
                </div>
            </div>
            ${new d("top: 50%;transform: translateY(-50%);left: calc(100% - 5px);",this.model.uid,"right",this.model.tableID,[this.model.tableID,this.model.uid])}
        `;u(e,this)}}c.bind("column-component",m);export{m as default};
