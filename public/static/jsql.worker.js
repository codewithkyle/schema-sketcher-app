(()=>{var Ne=(i,e)=>e.some(n=>i instanceof n),se,ie;function Re(){return se||(se=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function De(){return ie||(ie=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var ae=new WeakMap,F=new WeakMap,oe=new WeakMap,Q=new WeakMap,B=new WeakMap;function _e(i){let e=new Promise((n,r)=>{let t=()=>{i.removeEventListener("success",s),i.removeEventListener("error",o)},s=()=>{n(M(i.result)),t()},o=()=>{r(i.error),t()};i.addEventListener("success",s),i.addEventListener("error",o)});return e.then(n=>{n instanceof IDBCursor&&ae.set(n,i)}).catch(()=>{}),B.set(e,i),e}function je(i){if(F.has(i))return;let e=new Promise((n,r)=>{let t=()=>{i.removeEventListener("complete",s),i.removeEventListener("error",o),i.removeEventListener("abort",o)},s=()=>{n(),t()},o=()=>{r(i.error||new DOMException("AbortError","AbortError")),t()};i.addEventListener("complete",s),i.addEventListener("error",o),i.addEventListener("abort",o)});F.set(i,e)}var V={get(i,e,n){if(i instanceof IDBTransaction){if(e==="done")return F.get(i);if(e==="objectStoreNames")return i.objectStoreNames||oe.get(i);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return M(i[e])},set(i,e,n){return i[e]=n,!0},has(i,e){return i instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in i}};function Pe(i){V=i(V)}function $e(i){return i===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){let r=i.call(W(this),e,...n);return oe.set(r,e.sort?e.sort():[e]),M(r)}:De().includes(i)?function(...e){return i.apply(W(this),e),M(ae.get(this))}:function(...e){return M(i.apply(W(this),e))}}function Ue(i){return typeof i=="function"?$e(i):(i instanceof IDBTransaction&&je(i),Ne(i,Re())?new Proxy(i,V):i)}function M(i){if(i instanceof IDBRequest)return _e(i);if(Q.has(i))return Q.get(i);let e=Ue(i);return e!==i&&(Q.set(i,e),B.set(e,i)),e}var W=i=>B.get(i);function ce(i,e,{blocked:n,upgrade:r,blocking:t,terminated:s}={}){let o=indexedDB.open(i,e),a=M(o);return r&&o.addEventListener("upgradeneeded",c=>{r(M(o.result),c.oldVersion,c.newVersion,M(o.transaction))}),n&&o.addEventListener("blocked",()=>n()),a.then(c=>{s&&c.addEventListener("close",()=>s()),t&&c.addEventListener("versionchange",()=>t())}).catch(()=>{}),a}var Fe=["get","getKey","getAll","getAllKeys","count"],Qe=["put","add","delete","clear"],K=new Map;function le(i,e){if(!(i instanceof IDBDatabase&&!(e in i)&&typeof e=="string"))return;if(K.get(e))return K.get(e);let n=e.replace(/FromIndex$/,""),r=e!==n,t=Qe.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(t||Fe.includes(n)))return;let s=async function(o,...a){let c=this.transaction(o,t?"readwrite":"readonly"),l=c.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[n](...a),t&&c.done]))[0]};return K.set(e,s),s}Pe(i=>({...i,get:(e,n,r)=>le(e,n)||i.get(e,n,r),has:(e,n)=>!!le(e,n)||i.has(e,n)}));function S(i){return Array.isArray?Array.isArray(i):fe(i)==="[object Array]"}var Be=1/0;function Ve(i){if(typeof i=="string")return i;let e=i+"";return e=="0"&&1/i==-Be?"-0":e}function We(i){return i==null?"":Ve(i)}function v(i){return typeof i=="string"}function he(i){return typeof i=="number"}function Ke(i){return i===!0||i===!1||Ge(i)&&fe(i)=="[object Boolean]"}function ue(i){return typeof i=="object"}function Ge(i){return ue(i)&&i!==null}function b(i){return i!=null}function G(i){return!i.trim().length}function fe(i){return i==null?i===void 0?"[object Undefined]":"[object Null]":Object.prototype.toString.call(i)}var He="Incorrect 'index' type",Ye=i=>`Invalid value for key ${i}`,Xe=i=>`Pattern length exceeds max of ${i}.`,ze=i=>`Missing ${i} property in key`,Je=i=>`Property 'weight' in key '${i}' must be a positive integer`,de=Object.prototype.hasOwnProperty,pe=class{constructor(e){this._keys=[],this._keyMap={};let n=0;e.forEach(r=>{let t=ge(r);n+=t.weight,this._keys.push(t),this._keyMap[t.id]=t,n+=t.weight}),this._keys.forEach(r=>{r.weight/=n})}get(e){return this._keyMap[e]}keys(){return this._keys}toJSON(){return JSON.stringify(this._keys)}};function ge(i){let e=null,n=null,r=null,t=1;if(v(i)||S(i))r=i,e=ye(i),n=H(i);else{if(!de.call(i,"name"))throw new Error(ze("name"));let s=i.name;if(r=s,de.call(i,"weight")&&(t=i.weight,t<=0))throw new Error(Je(s));e=ye(s),n=H(s)}return{path:e,id:n,weight:t,src:r}}function ye(i){return S(i)?i:i.split(".")}function H(i){return S(i)?i.join("."):i}function Ze(i,e){let n=[],r=!1,t=(s,o,a)=>{if(!!b(s))if(!o[a])n.push(s);else{let c=o[a],l=s[c];if(!b(l))return;if(a===o.length-1&&(v(l)||he(l)||Ke(l)))n.push(We(l));else if(S(l)){r=!0;for(let h=0,u=l.length;h<u;h+=1)t(l[h],o,a+1)}else o.length&&t(l,o,a+1)}};return t(i,v(e)?e.split("."):e,0),r?n:n[0]}var qe={includeMatches:!1,findAllMatches:!1,minMatchCharLength:1},et={isCaseSensitive:!1,includeScore:!1,keys:[],shouldSort:!0,sortFn:(i,e)=>i.score===e.score?i.idx<e.idx?-1:1:i.score<e.score?-1:1},tt={location:0,threshold:.6,distance:100},nt={useExtendedSearch:!1,getFn:Ze,ignoreLocation:!1,ignoreFieldNorm:!1},d={...et,...qe,...tt,...nt},rt=/[^ ]+/g;function st(i=3){let e=new Map,n=Math.pow(10,i);return{get(r){let t=r.match(rt).length;if(e.has(t))return e.get(t);let s=1/Math.sqrt(t),o=parseFloat(Math.round(s*n)/n);return e.set(t,o),o},clear(){e.clear()}}}var j=class{constructor({getFn:e=d.getFn}={}){this.norm=st(3),this.getFn=e,this.isCreated=!1,this.setIndexRecords()}setSources(e=[]){this.docs=e}setIndexRecords(e=[]){this.records=e}setKeys(e=[]){this.keys=e,this._keysMap={},e.forEach((n,r)=>{this._keysMap[n.id]=r})}create(){this.isCreated||!this.docs.length||(this.isCreated=!0,v(this.docs[0])?this.docs.forEach((e,n)=>{this._addString(e,n)}):this.docs.forEach((e,n)=>{this._addObject(e,n)}),this.norm.clear())}add(e){let n=this.size();v(e)?this._addString(e,n):this._addObject(e,n)}removeAt(e){this.records.splice(e,1);for(let n=e,r=this.size();n<r;n+=1)this.records[n].i-=1}getValueForItemAtKeyId(e,n){return e[this._keysMap[n]]}size(){return this.records.length}_addString(e,n){if(!b(e)||G(e))return;let r={v:e,i:n,n:this.norm.get(e)};this.records.push(r)}_addObject(e,n){let r={i:n,$:{}};this.keys.forEach((t,s)=>{let o=this.getFn(e,t.path);if(!!b(o)){if(S(o)){let a=[],c=[{nestedArrIndex:-1,value:o}];for(;c.length;){let{nestedArrIndex:l,value:h}=c.pop();if(!!b(h))if(v(h)&&!G(h)){let u={v:h,i:l,n:this.norm.get(h)};a.push(u)}else S(h)&&h.forEach((u,f)=>{c.push({nestedArrIndex:f,value:u})})}r.$[s]=a}else if(!G(o)){let a={v:o,n:this.norm.get(o)};r.$[s]=a}}}),this.records.push(r)}toJSON(){return{keys:this.keys,records:this.records}}};function be(i,e,{getFn:n=d.getFn}={}){let r=new j({getFn:n});return r.setKeys(i.map(ge)),r.setSources(e),r.create(),r}function it(i,{getFn:e=d.getFn}={}){let{keys:n,records:r}=i,t=new j({getFn:e});return t.setKeys(n),t.setIndexRecords(r),t}function P(i,{errors:e=0,currentLocation:n=0,expectedLocation:r=0,distance:t=d.distance,ignoreLocation:s=d.ignoreLocation}={}){let o=e/i.length;if(s)return o;let a=Math.abs(r-n);return t?o+a/t:a?1:o}function at(i=[],e=d.minMatchCharLength){let n=[],r=-1,t=-1,s=0;for(let o=i.length;s<o;s+=1){let a=i[s];a&&r===-1?r=s:!a&&r!==-1&&(t=s-1,t-r+1>=e&&n.push([r,t]),r=-1)}return i[s-1]&&s-r>=e&&n.push([r,s-1]),n}var T=32;function ot(i,e,n,{location:r=d.location,distance:t=d.distance,threshold:s=d.threshold,findAllMatches:o=d.findAllMatches,minMatchCharLength:a=d.minMatchCharLength,includeMatches:c=d.includeMatches,ignoreLocation:l=d.ignoreLocation}={}){if(e.length>T)throw new Error(Xe(T));let h=e.length,u=i.length,f=Math.max(0,Math.min(r,u)),p=s,g=f,y=a>1||c,x=y?Array(u):[],I;for(;(I=i.indexOf(e,g))>-1;){let m=P(e,{currentLocation:I,expectedLocation:f,distance:t,ignoreLocation:l});if(p=Math.min(m,p),g=I+h,y){let k=0;for(;k<h;)x[I+k]=1,k+=1}}g=-1;let O=[],C=1,D=h+u,Oe=1<<h-1;for(let m=0;m<h;m+=1){let k=0,w=D;for(;k<w;)P(e,{errors:m,currentLocation:f+w,expectedLocation:f,distance:t,ignoreLocation:l})<=p?k=w:D=w,w=Math.floor((D-k)/2+k);D=w;let ne=Math.max(1,f-w+1),U=o?u:Math.min(f+w,u)+h,N=Array(U+2);N[U+1]=(1<<m)-1;for(let E=U;E>=ne;E-=1){let _=E-1,re=n[i.charAt(_)];if(y&&(x[_]=+!!re),N[E]=(N[E+1]<<1|1)&re,m&&(N[E]|=(O[E+1]|O[E])<<1|1|O[E+1]),N[E]&Oe&&(C=P(e,{errors:m,currentLocation:_,expectedLocation:f,distance:t,ignoreLocation:l}),C<=p)){if(p=C,g=_,g<=f)break;ne=Math.max(1,2*f-g)}}if(P(e,{errors:m+1,currentLocation:f,expectedLocation:f,distance:t,ignoreLocation:l})>p)break;O=N}let $={isMatch:g>=0,score:Math.max(.001,C)};if(y){let m=at(x,a);m.length?c&&($.indices=m):$.isMatch=!1}return $}function ct(i){let e={};for(let n=0,r=i.length;n<r;n+=1){let t=i.charAt(n);e[t]=(e[t]||0)|1<<r-n-1}return e}var Y=class{constructor(e,{location:n=d.location,threshold:r=d.threshold,distance:t=d.distance,includeMatches:s=d.includeMatches,findAllMatches:o=d.findAllMatches,minMatchCharLength:a=d.minMatchCharLength,isCaseSensitive:c=d.isCaseSensitive,ignoreLocation:l=d.ignoreLocation}={}){if(this.options={location:n,threshold:r,distance:t,includeMatches:s,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:c,ignoreLocation:l},this.pattern=c?e:e.toLowerCase(),this.chunks=[],!this.pattern.length)return;let h=(f,p)=>{this.chunks.push({pattern:f,alphabet:ct(f),startIndex:p})},u=this.pattern.length;if(u>T){let f=0,p=u%T,g=u-p;for(;f<g;)h(this.pattern.substr(f,T),f),f+=T;if(p){let y=u-T;h(this.pattern.substr(y),y)}}else h(this.pattern,0)}searchIn(e){let{isCaseSensitive:n,includeMatches:r}=this.options;if(n||(e=e.toLowerCase()),this.pattern===e){let g={isMatch:!0,score:0};return r&&(g.indices=[[0,e.length-1]]),g}let{location:t,distance:s,threshold:o,findAllMatches:a,minMatchCharLength:c,ignoreLocation:l}=this.options,h=[],u=0,f=!1;this.chunks.forEach(({pattern:g,alphabet:y,startIndex:x})=>{let{isMatch:I,score:O,indices:C}=ot(e,g,y,{location:t+x,distance:s,threshold:o,findAllMatches:a,minMatchCharLength:c,includeMatches:r,ignoreLocation:l});I&&(f=!0),u+=O,I&&C&&(h=[...h,...C])});let p={isMatch:f,score:f?u/this.chunks.length:1};return f&&r&&(p.indices=h),p}},A=class{constructor(e){this.pattern=e}static isMultiMatch(e){return me(e,this.multiRegex)}static isSingleMatch(e){return me(e,this.singleRegex)}search(){}};function me(i,e){let n=i.match(e);return n?n[1]:null}var Ee=class extends A{constructor(e){super(e)}static get type(){return"exact"}static get multiRegex(){return/^="(.*)"$/}static get singleRegex(){return/^=(.*)$/}search(e){let n=e===this.pattern;return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}},Ie=class extends A{constructor(e){super(e)}static get type(){return"inverse-exact"}static get multiRegex(){return/^!"(.*)"$/}static get singleRegex(){return/^!(.*)$/}search(e){let r=e.indexOf(this.pattern)===-1;return{isMatch:r,score:r?0:1,indices:[0,e.length-1]}}},Se=class extends A{constructor(e){super(e)}static get type(){return"prefix-exact"}static get multiRegex(){return/^\^"(.*)"$/}static get singleRegex(){return/^\^(.*)$/}search(e){let n=e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,this.pattern.length-1]}}},ve=class extends A{constructor(e){super(e)}static get type(){return"inverse-prefix-exact"}static get multiRegex(){return/^!\^"(.*)"$/}static get singleRegex(){return/^!\^(.*)$/}search(e){let n=!e.startsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}},Ae=class extends A{constructor(e){super(e)}static get type(){return"suffix-exact"}static get multiRegex(){return/^"(.*)"\$$/}static get singleRegex(){return/^(.*)\$$/}search(e){let n=e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[e.length-this.pattern.length,e.length-1]}}},ke=class extends A{constructor(e){super(e)}static get type(){return"inverse-suffix-exact"}static get multiRegex(){return/^!"(.*)"\$$/}static get singleRegex(){return/^!(.*)\$$/}search(e){let n=!e.endsWith(this.pattern);return{isMatch:n,score:n?0:1,indices:[0,e.length-1]}}},X=class extends A{constructor(e,{location:n=d.location,threshold:r=d.threshold,distance:t=d.distance,includeMatches:s=d.includeMatches,findAllMatches:o=d.findAllMatches,minMatchCharLength:a=d.minMatchCharLength,isCaseSensitive:c=d.isCaseSensitive,ignoreLocation:l=d.ignoreLocation}={}){super(e);this._bitapSearch=new Y(e,{location:n,threshold:r,distance:t,includeMatches:s,findAllMatches:o,minMatchCharLength:a,isCaseSensitive:c,ignoreLocation:l})}static get type(){return"fuzzy"}static get multiRegex(){return/^"(.*)"$/}static get singleRegex(){return/^(.*)$/}search(e){return this._bitapSearch.searchIn(e)}},z=class extends A{constructor(e){super(e)}static get type(){return"include"}static get multiRegex(){return/^'"(.*)"$/}static get singleRegex(){return/^'(.*)$/}search(e){let n=0,r,t=[],s=this.pattern.length;for(;(r=e.indexOf(this.pattern,n))>-1;)n=r+s,t.push([r,n-1]);let o=!!t.length;return{isMatch:o,score:o?0:1,indices:t}}},J=[Ee,z,Se,ve,ke,Ae,Ie,X],we=J.length,lt=/ +(?=([^\"]*\"[^\"]*\")*[^\"]*$)/,ht="|";function ut(i,e={}){return i.split(ht).map(n=>{let r=n.trim().split(lt).filter(s=>s&&!!s.trim()),t=[];for(let s=0,o=r.length;s<o;s+=1){let a=r[s],c=!1,l=-1;for(;!c&&++l<we;){let h=J[l],u=h.isMultiMatch(a);u&&(t.push(new h(u,e)),c=!0)}if(!c)for(l=-1;++l<we;){let h=J[l],u=h.isSingleMatch(a);if(u){t.push(new h(u,e));break}}}return t})}var ft=new Set([X.type,z.type]),Me=class{constructor(e,{isCaseSensitive:n=d.isCaseSensitive,includeMatches:r=d.includeMatches,minMatchCharLength:t=d.minMatchCharLength,ignoreLocation:s=d.ignoreLocation,findAllMatches:o=d.findAllMatches,location:a=d.location,threshold:c=d.threshold,distance:l=d.distance}={}){this.query=null,this.options={isCaseSensitive:n,includeMatches:r,minMatchCharLength:t,findAllMatches:o,ignoreLocation:s,location:a,threshold:c,distance:l},this.pattern=n?e:e.toLowerCase(),this.query=ut(this.pattern,this.options)}static condition(e,n){return n.useExtendedSearch}searchIn(e){let n=this.query;if(!n)return{isMatch:!1,score:1};let{includeMatches:r,isCaseSensitive:t}=this.options;e=t?e:e.toLowerCase();let s=0,o=[],a=0;for(let c=0,l=n.length;c<l;c+=1){let h=n[c];o.length=0,s=0;for(let u=0,f=h.length;u<f;u+=1){let p=h[u],{isMatch:g,indices:y,score:x}=p.search(e);if(g){if(s+=1,a+=x,r){let I=p.constructor.type;ft.has(I)?o=[...o,...y]:o.push(y)}}else{a=0,s=0,o.length=0;break}}if(s){let u={isMatch:!0,score:a/s};return r&&(u.indices=o),u}}return{isMatch:!1,score:1}}},Z=[];function dt(...i){Z.push(...i)}function q(i,e){for(let n=0,r=Z.length;n<r;n+=1){let t=Z[n];if(t.condition(i,e))return new t(i,e)}return new Y(i,e)}var R={AND:"$and",OR:"$or"},ee={PATH:"$path",PATTERN:"$val"},te=i=>!!(i[R.AND]||i[R.OR]),pt=i=>!!i[ee.PATH],gt=i=>!S(i)&&ue(i)&&!te(i),xe=i=>({[R.AND]:Object.keys(i).map(e=>({[e]:i[e]}))});function Ce(i,e,{auto:n=!0}={}){let r=t=>{let s=Object.keys(t),o=pt(t);if(!o&&s.length>1&&!te(t))return r(xe(t));if(gt(t)){let c=o?t[ee.PATH]:s[0],l=o?t[ee.PATTERN]:t[c];if(!v(l))throw new Error(Ye(c));let h={keyId:H(c),pattern:l};return n&&(h.searcher=q(l,e)),h}let a={children:[],operator:s[0]};return s.forEach(c=>{let l=t[c];S(l)&&l.forEach(h=>{a.children.push(r(h))})}),a};return te(i)||(i=xe(i)),r(i)}function yt(i,{ignoreFieldNorm:e=d.ignoreFieldNorm}){i.forEach(n=>{let r=1;n.matches.forEach(({key:t,norm:s,score:o})=>{let a=t?t.weight:null;r*=Math.pow(o===0&&a?Number.EPSILON:o,(a||1)*(e?1:s))}),n.score=r})}function bt(i,e){let n=i.matches;e.matches=[],!!b(n)&&n.forEach(r=>{if(!b(r.indices)||!r.indices.length)return;let{indices:t,value:s}=r,o={indices:t,value:s};r.key&&(o.key=r.key.src),r.idx>-1&&(o.refIndex=r.idx),e.matches.push(o)})}function mt(i,e){e.score=i.score}function Et(i,e,{includeMatches:n=d.includeMatches,includeScore:r=d.includeScore}={}){let t=[];return n&&t.push(bt),r&&t.push(mt),i.map(s=>{let{idx:o}=s,a={item:e[o],refIndex:o};return t.length&&t.forEach(c=>{c(s,a)}),a})}var L=class{constructor(e,n={},r){this.options={...d,...n},this.options.useExtendedSearch,this._keyStore=new pe(this.options.keys),this.setCollection(e,r)}setCollection(e,n){if(this._docs=e,n&&!(n instanceof j))throw new Error(He);this._myIndex=n||be(this.options.keys,this._docs,{getFn:this.options.getFn})}add(e){!b(e)||(this._docs.push(e),this._myIndex.add(e))}remove(e=()=>!1){let n=[];for(let r=0,t=this._docs.length;r<t;r+=1){let s=this._docs[r];e(s,r)&&(this.removeAt(r),r-=1,t-=1,n.push(s))}return n}removeAt(e){this._docs.splice(e,1),this._myIndex.removeAt(e)}getIndex(){return this._myIndex}search(e,{limit:n=-1}={}){let{includeMatches:r,includeScore:t,shouldSort:s,sortFn:o,ignoreFieldNorm:a}=this.options,c=v(e)?v(this._docs[0])?this._searchStringList(e):this._searchObjectList(e):this._searchLogical(e);return yt(c,{ignoreFieldNorm:a}),s&&c.sort(o),he(n)&&n>-1&&(c=c.slice(0,n)),Et(c,this._docs,{includeMatches:r,includeScore:t})}_searchStringList(e){let n=q(e,this.options),{records:r}=this._myIndex,t=[];return r.forEach(({v:s,i:o,n:a})=>{if(!b(s))return;let{isMatch:c,score:l,indices:h}=n.searchIn(s);c&&t.push({item:s,idx:o,matches:[{score:l,value:s,norm:a,indices:h}]})}),t}_searchLogical(e){let n=Ce(e,this.options),r=(a,c,l)=>{if(!a.children){let{keyId:h,searcher:u}=a,f=this._findMatches({key:this._keyStore.get(h),value:this._myIndex.getValueForItemAtKeyId(c,h),searcher:u});return f&&f.length?[{idx:l,item:c,matches:f}]:[]}switch(a.operator){case R.AND:{let h=[];for(let u=0,f=a.children.length;u<f;u+=1){let p=a.children[u],g=r(p,c,l);if(g.length)h.push(...g);else return[]}return h}case R.OR:{let h=[];for(let u=0,f=a.children.length;u<f;u+=1){let p=a.children[u],g=r(p,c,l);if(g.length){h.push(...g);break}}return h}}},t=this._myIndex.records,s={},o=[];return t.forEach(({$:a,i:c})=>{if(b(a)){let l=r(n,a,c);l.length&&(s[c]||(s[c]={idx:c,item:a,matches:[]},o.push(s[c])),l.forEach(({matches:h})=>{s[c].matches.push(...h)}))}}),o}_searchObjectList(e){let n=q(e,this.options),{keys:r,records:t}=this._myIndex,s=[];return t.forEach(({$:o,i:a})=>{if(!b(o))return;let c=[];r.forEach((l,h)=>{c.push(...this._findMatches({key:l,value:o[h],searcher:n}))}),c.length&&s.push({idx:a,item:o,matches:c})}),s}_findMatches({key:e,value:n,searcher:r}){if(!b(n))return[];let t=[];if(S(n))n.forEach(({v:s,i:o,n:a})=>{if(!b(s))return;let{isMatch:c,score:l,indices:h}=r.searchIn(s);c&&t.push({score:l,key:e,value:s,idx:o,norm:a,indices:h})});else{let{v:s,n:o}=n,{isMatch:a,score:c,indices:l}=r.searchIn(s);a&&t.push({score:c,key:e,value:s,norm:o,indices:l})}return t}};L.version="6.4.6";L.createIndex=be;L.parseIndex=it;L.config=d;L.parseQuery=Ce;dt(Me);var Te=L;var Le=class{constructor(){this.db=null,this.tables=null,self.onmessage=this.inbox.bind(this)}async inbox(e){let{type:n,uid:r,data:t}=e.data;try{let s=null;switch(n){case"init":await this.init(t);break;case"query":let o=[];Array.isArray(t)?o=t:o=[t],s=await this.performQuery(o);break;case"sql":let a=await this.buildQueriesFromSQL(t);s=await this.performQuery(a);break;default:console.warn(`Invalid JSQL Worker message type: ${n}`);break}this.send("response",s,r)}catch(s){this.send("error",s,r)}}send(e,n=null,r=null,t=null){let s={type:e,data:n,uid:r};t?self.postMessage(s,t):self.postMessage(s)}async init(e){let n=await fetch(e,{method:"GET",headers:new Headers({Accept:"application/json"}),credentials:"include"});if(!n.ok)throw`${n.status}: ${n.statusText}`;let r=await n.json();this.tables=r.tables,this.db=await ce(r.name,r.version,{upgrade(t,s,o,a){for(let c=0;c<t.objectStoreNames.length;c++)t.deleteObjectStore(t.objectStoreNames[c]);for(let c=0;c<r.tables.length;c++){let l=r.tables[c],h={keyPath:"id",autoIncrement:!1};l?.keyPath&&(h.keyPath=l.keyPath),typeof l.autoIncrement!="undefined"&&(h.autoIncrement=l.autoIncrement);let u=t.createObjectStore(l.name,h);for(let f=0;f<l.columns.length;f++){let p=l.columns[f];u.createIndex(p.key,p.key,{unique:p?.unique??!1})}}},blocked(){console.error("This app needs to restart. Close all tabs for this app and before relaunching.")},blocking(){console.error("This app needs to restart. Close all tabs for this app and before relaunching.")}})}async performQuery(e){let n=[];for(let r=0;r<e.length;r++){let t=e[r],s=[],o=!1;t.type!=="INSERT"&&t.table!=="*"&&(t.where!==null&&t.where.length===1&&t.where[0].checks.length===1&&!Array.isArray(t.where[0].checks[0])&&t.where[0].checks[0].type==="=="?(o=!0,s=await this.db.getAllFromIndex(t.table,t.where[0].checks[0].column,t.where[0].checks[0].value)):s=await this.db.getAll(t.table));let a=[];switch(t.type){case"RESET":if(t.table==="*"){let l=[];for(let h=0;h<this.tables.length;h++)l.push(this.db.clear(this.tables[h].name));await Promise.all(l)}else await this.db.clear(t.table);break;case"UPDATE":t.where!==null&&!o&&(s=this.handleWhere(t,s));for(let l=0;l<s.length;l++){let h=!1;console.log(t.set,s);for(let u in t.set)u in s[l]&&(s[l][u]=t.set[u],h=!0);h&&a.push(this.db.put(t.table,s[l]))}await Promise.all(a);break;case"DELETE":t.where!==null&&!o&&(s=this.handleWhere(t,s));let c=this.getTableKey(t.table);for(let l=0;l<s.length;l++)a.push(this.db.delete(t.table,s[l][c]));await Promise.all(a);break;case"SELECT":t.where!==null&&!o&&(s=this.handleWhere(t,s));break;case"INSERT":for(let l of t.values)await this.db.put(t.table,l);s=t.values;break;default:break}if(t.type==="SELECT"&&(t.function!==null?s=this.handleSelectFunction(t,s):(t.uniqueOnly&&(s=this.getUnique(s,t.columns)),t.columns.length&&t.columns[0]!=="*"&&(s=this.filterColumns(t,s)),t.order!==null&&this.sort(t,s),t.limit!==null&&(s=s.splice(t.offset,t.limit)))),t.uniqueOnly){let c=[];for(let l=0;l<s.length;l++)c.push(s[l][t.columns[0]]);s=c}else t.group!==null&&(s=this.buildGroups(s,t.group));Array.isArray(s)?n=[...n,...s]:n.push(s)}return e.length===1&&e[0].group!==null&&(n=n[0]),n}buildGroups(e,n){let r={};for(let t=0;t<e.length;t++)e[t][n]in r?r[e[t][n]].push(e[t]):r[e[t][n]]=[e[t]];return r}getUnique(e,n){let r=[],t=[];for(let s=0;s<e.length;s++)t.includes(e[s][n[0]])||(t.push(e[s][n[0]]),r.push(e[s]));return r}getTableKey(e){let n="id";for(let r=0;r<this.tables.length;r++)if(this.tables[r].name===e){this.tables[r]?.keyPath&&(n=this.tables[r].keyPath);break}return n}check(e,n){let r=!1;switch(e.type){case"LIKE":new Te([n],{keys:[e.column],ignoreLocation:!0,threshold:0}).search(e.value).length&&(r=!0);break;case"INCLUDES":Array.isArray(n[e.column])&&n[e.column].includes(e.value)&&(r=!0);break;case"EXCLUDES":Array.isArray(n[e.column])&&!n[e.column].includes(e.value)&&(r=!0);break;case">=":n[e.column]>=e.value&&(r=!0);break;case">":n[e.column]>e.value&&(r=!0);break;case"<=":n[e.column]<=e.value&&(r=!0);break;case"<":n[e.column]<e.value&&(r=!0);break;case"!>=":n[e.column]<e.value&&(r=!0);break;case"!>":n[e.column]<=e.value&&(r=!0);break;case"!==":n[e.column]!==e.value&&(r=!0);break;case"!=":n[e.column]!=e.value&&(r=!0);break;case"!<=":n[e.column]>e.value&&(r=!0);break;case"!<":n[e.column]>=e.value&&(r=!0);break;case"==":n[e.column]===e.value&&(r=!0);break;case"=":n[e.column]==e.value&&(r=!0);break;default:break}return r}handleWhere(e,n){let r=[];for(let t=0;t<n.length;t++){let s=n[t],o=!1;for(let a=0;a<e.where.length;a++){let c=e.where[a],l=0,h=c.checks.length;for(let u=0;u<c.checks.length;u++){let f=c.checks[u];if(Array.isArray(f)){let p=0,g=f.length;for(let y=0;y<f.length;y++)this.check(f[y],s)&&p++;p===g&&l++}else this.check(f,s)&&l++;if(l!==0&&!c.requireAll){o=!0;break}}if(o||l===h){o=!0;break}}o&&r.push(s)}return r}handleSelectFunction(e,n){let r;switch(e.function){case"MIN":let t;for(let a=0;a<n.length;a++){let c=n[a]?.[e.columns[0]]??0;(a===0||c<t)&&(t=c)}r=t;break;case"MAX":let s;for(let a=0;a<n.length;a++){let c=n[a]?.[e.columns[0]]??0;(a===0||c>s)&&(s=c)}r=s;break;case"SUM":r=0;for(let a=0;a<n.length;a++){let c=n[a]?.[e.columns[0]]??0;(isNaN(c)||!isFinite(c))&&(c=0),r+=c}break;case"AVG":let o=0;for(let a=0;a<n.length;a++){let c=n[a]?.[e.columns[0]]??0;(isNaN(c)||!isFinite(c))&&(c=0),o+=c}r=o/n.length;break;case"COUNT":r=n.length;break;default:break}return r}sort(e,n){e.order.by==="ASC"?n.sort((r,t)=>{let s=r?.[e.order.column]??0,o=t?.[e.order.column]??0;return s>=o?1:-1}):n.sort((r,t)=>{let s=r?.[e.order.column]??0,o=t?.[e.order.column]??0;return s>=o?-1:1})}filterColumns(e,n){let r=[];for(let t=0;t<n.length;t++){let s=n[t],o={};for(let a=0;a<e.columns.length;a++)o[e.columns[a]]=s?.[e.columns[a]]??null;r.push(o)}return r}buildQueryFromStatement(e,n={}){let r=this.parseSegments(e),t={uniqueOnly:!1,type:null,function:null,table:null,columns:null,offset:0,limit:null,where:null,values:null,order:null,set:null,group:null};for(let s=r.length-1;s>=0;s--){let o=r[s].join(" ");if(o.indexOf("+")!==-1||o.indexOf("/")!==-1||o.indexOf("%")!==-1)throw`Invalid syntax. Arithmetic operators are not currently supported ${o}`;if(o.indexOf("&")!==-1||o.indexOf("|")!==-1||o.indexOf("^")!==-1)throw"Invalid syntax. Bitwise operators are not currently supported";switch(r[s][0].toUpperCase()){case"SET":t=this.parseSetSegment(r[s],t,n);break;case"VALUES":t=this.parseValues(r[s],t,n);break;case"OFFSET":if(r[s].length!==2)throw`Invalid syntax at: ${r[s].join(" ")}`;t.offset=parseInt(r[s][1]);break;case"LIMIT":if(r[s].length!==2)throw`Invalid syntax at: ${r[s].join(" ")}`;t.limit=parseInt(r[s][1]);break;case"GROUP":t=this.parseGroupBySegment(r[s],t);break;case"ORDER":t=this.parseOrderBySegment(r[s],t);break;case"WHERE":t=this.parseWhereSegment(r[s],t,n);break;case"FROM":if(r[s].length!==2)throw`Invalid syntax at: ${r[s].join(" ")}`;t.table=r[s][1];break;case"SELECT":t.type="SELECT",t=this.parseSelectSegment(r[s],t,n);break;case"DELETE":t.type="DELETE";break;case"INSERT":t.type="INSERT",t=this.parseInsertSegment(r[s],t);break;case"UPDATE":if(r[s].length!==2)throw`Invalid syntax at: ${r[s].join(" ")}`;t.table=r[s][1],t.type="UPDATE";break;case"RESET":if(r[s].length!==2)throw`Invalid syntax at: ${r[s].join(" ")}`;t.table=r[s][1],t.type="RESET";break;default:throw`Invalid syntax at: ${r[s].join(" ")}`}}if(t.type===null)throw"Invalid syntax: Missing SELECT, UPDATE, INSERT INTO, or DELETE statement.";if(t.table===null)throw"Invalid syntax: Missing FROM.";if(t.type==="SELECT"&&t.columns===null)throw"Invalid syntax: Missing columns.";if(t.type==="INSERT"&&t.values===null)throw"Invalid syntax: Missing VALUES.";if(t.type==="UPDATE"&&t.set===null)throw"Invalid syntax: Missing SET.";if(t.type==="UPDATE"&&t.where===null)throw"Invalid syntax: Missing WHERE.";if(isNaN(t.limit))throw"Invalid syntax: LIMIT is not a number.";if(isNaN(t.offset))throw"Invalid syntax: OFFSET is not a number.";return t.table=this.injectParameter(t.table,n),t}async buildQueriesFromSQL({sql:e,params:n}){e=e.replace(/\-\-.*|\;$/g,"").trim();let r=[],t=e.split(/\bUNION\b/i);for(let s=0;s<t.length;s++)r.push(this.buildQueryFromStatement(t[s],n));return r}parseSetSegment(e,n,r){if(e.length<2)throw`Invalid syntax at: ${e.join(" ")}.`;{n.set={},e.splice(0,1);let t=e.join(" ").trim().split(",");for(let s=0;s<t.length;s++){let o=t[s].trim().split("=");if(o.length!==2)throw`Invalid syntax at: ${t[s]}`;n.set[o[0].trim()]=o[1].trim().replace(/^[\"\']|[\"\']$/g,"")}}for(let t in n.set)n.set[t]=this.injectParameter(n.set[t],r);return n}buildConditionCheck(e){let n;if(Array.isArray(e)){n=[];for(let r=0;r<e.length;r++){let t={column:"",type:"=",value:null};e[r]=e[r].trim().replace(/\'|\"/g,""),t.type=e[r].match(/\=|\=\=|\!\=|\!\=\=|\>|\<|\>\=|\<\=|\!\>\=|\!\<\=|\!\>|\!\<|\bLIKE\b|\bINCLUDES\b|\bEXCLUDES\b/ig).join("").trim();let s=e[r].split(t.type);t.column=s[0],t.value=s[1],n.push(t)}}else{let r={column:"",type:"=",value:null};e=e.trim().replace(/\'|\"/g,""),r.type=e.match(/\=|\=\=|\!\=|\!\=\=|\>|\<|\>\=|\<\=|\!\>\=|\!\<\=|\!\>|\!\<|\bLIKE\b|\bINCLUDES\b|\bEXCLUDES\b/ig).join("").trim();let t=e.split(r.type);r.column=t[0].trim(),r.value=t[1].trim(),n=r}return n}buildConditions(e){let n={requireAll:!0,checks:[]},r=[];if(e.search(/\bOR\b/i)!==-1){n.requireAll=!1,r=e.split(/\bOR\b/i);for(let t=0;t<r.length;t++)r[t].search(/\bAND\b/i)!==-1&&r.splice(t,1,r[t].split(/\bAND\b/i))}else r=e.split(/\bAND\b/i);for(let t=0;t<r.length;t++)n.checks.push(this.buildConditionCheck(r[t]));return n}parseWhereSegment(e,n,r){if(e.length<2)throw`Invalid syntax at: ${e.join(" ")}.`;{n.where=[],e.splice(0,1);let t=[],s=0;for(let a=e.length-1;a>=0;a--){let c=-1;switch(s+=(e[a].match(/\)/g)||[]).length,s-=(e[a].match(/\(/g)||[]).length,e[a].toUpperCase()){case"OR":s===0&&(c=a);break;default:break}c!==-1?t.push(e.splice(c,e.length)):a===0&&t.push(e.splice(0,e.length))}t.reverse();for(let a=0;a<t.length;a++)t[a][0].toUpperCase()==="OR"&&t[a].splice(0,1);for(let a=0;a<t.length;a++){let c=t[a].join(" ");c=c.trim().replace(/^\(|\)$/g,"").trim(),t.splice(a,1,c)}let o=[];for(let a=0;a<t.length;a++){let c=this.buildConditions(t[a]);o.push(c)}n.where=o;for(let a=0;a<n.where.length;a++)for(let c=0;c<n.where[a].checks.length;c++)if(Array.isArray(n.where[a].checks[c]))for(let l=0;l<n.where[a].checks[c].length;l++){let h=n.where[a].checks[c][l],u=this.injectParameter(h.value,r);n.where[a].checks[c][l].value=u}else{let l=n.where[a].checks[c],h=this.injectParameter(l.value,r);n.where[a].checks[c]=h}return n}}parseGroupBySegment(e,n){if(e.length!==3)throw"Invalid syntax. GROUP BY only currently supports single column sorting.";if(n.uniqueOnly)throw"Invalid syntax. GROUP BY can not be used with UNIQUE or DISTINCT statements.";return n.group=e[2],n}parseOrderBySegment(e,n){if(e.length<3||e[1]!=="BY")throw`Invalid syntax at: ${e.join(" ")}.`;if(e.splice(0,2),e.length>2||e[0].indexOf(",")!==-1)throw"Invalid syntax. ORDER BY only currently supports single column sorting.";{let r="ASC";if(e?.[1]&&(r=e[1].toUpperCase(),r!=="ASC"&&r!=="DESC"))throw"Invalid syntax. ORDER BY only currently supports ASC or DESC sorting.";n.order={column:e[0],by:r}}return n}parseValues(e,n,r){if(e.length===1)throw`Invalid syntax at: ${e}.`;{n.values=[],e.splice(0,1);let t=e.join("").replace(/\(|\)|\s/g,"").split(",");for(let s=0;s<t.length;s++)n.values.push(this.injectParameter(t[s],r))}return n}injectParameter(e,n){if(e.indexOf("$")===0){let r=e.substring(1,e.length);if(r in n)return n[r];throw`Invalid params. Missing key: ${r}`}return e}parseInsertSegment(e,n){if(e.length<3||e[1]!=="INTO")throw`Invalid syntax at: ${e.join(" ")}.`;if(e.length===3)n.table=e[2];else throw"Invalid syntax. Only 'INSERT INTO table_name' queries are currently supported.";return n}parseSelectSegment(e,n,r){if(e.includes("*")&&(n.columns=["*"]),e[1].toUpperCase()==="DISTINCT"||e[1].toUpperCase()==="UNIQUE"){if(e.includes("*"))throw"Invalid SELECT statement. DISTINCT or UNIQUE does not currently support the wildcard (*) character.";if(n.uniqueOnly=!0,e.splice(1,1),e.length>2)throw"Invalid SELECT statement. DISTINCT or UNIQUE does not currently support multiple columns."}else if(e[1].toUpperCase().search(/\bCOUNT\b/i)===0||e[1].toUpperCase().search(/\bMIN\b/i)===0||e[1].toUpperCase().search(/\bMAX\b/i)===0||e[1].toUpperCase().search(/\bAVG\b/i)===0||e[1].toUpperCase().search(/\bSUM\b/i)===0){if(e.includes("*"))throw"Invalid SELECT statement. Functions can not be used with the wildcard (*) character.";let t=e[1].match(/\w+/)[0].trim().toUpperCase(),s=e[1].match(/\(.*?\)/)[0].replace(/\(|\)/g,"").trim();n.function=t,n.columns=[s]}if(n.columns===null){if(e.length===1)throw"Invalid SELECT statement syntax.";n.columns=[];for(let t=1;t<e.length;t++){let s=e[t].split(",");for(let o=0;o<s.length;o++){let a=s[o].trim();a.length&&n.columns.push(this.injectParameter(a,r))}}}return n}parseSegments(e){let n=e.trim().split(/\s+/),r=[];for(;n.length>0;){let t=-1;for(let s=n.length-1;s>=0;s--){switch(n[s].toUpperCase()){case"HAVING":throw"Invalid syntax: HAVING clause is not currently supported.";case"UNION":throw"Invalid syntax: UNION operator is not currently supported.";case"JOIN":throw"Invalid syntax: JOIN clause is not currently supported.";case"SET":t=s;break;case"VALUES":t=s;break;case"OFFSET":t=s;break;case"LIMIT":t=s;break;case"ORDER":t=s;break;case"WHERE":t=s;break;case"FROM":t=s;break;case"SELECT":t=s;break;case"DELETE":t=s;break;case"INSERT":t=s;break;case"UPDATE":t=s;break;case"RESET":t=s;break;case"GROUP":t=s;break;default:break}if(t!==-1)break}if(t===-1&&n.length>0)throw`Invalid syntax: ${e}`;r.push(n.splice(t,n.length))}return r}};new Le;})();